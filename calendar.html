<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeSync — Calendar</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <!-- ===== Header ===== -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">
        <img src="assets/logo.svg" alt="TimeSync Logo" width="40" />
        <div>
          <div class="brand-name">TimeSync</div>
          <div class="brand-slogan">Synchronize your time. Simplify your life.</div>
        </div>
      </a>

      <nav class="main-nav" id="nav-menu">
        <ul>
          <li><a href="index.html" class="nav-link">Home</a></li>
          <li><a href="task-manager.html" class="nav-link">Task Manager</a></li>
          <li><a href="pomodoro.html" class="nav-link">Pomodoro Timer</a></li>
          <li><a href="calendar.html" class="nav-link active">Calendar</a></li>
        </ul>
      </nav>

      <button class="nav-toggle" id="nav-toggle">☰</button>
    </div>
  </header>

  <!-- ===== Main Calendar Section ===== -->
  <main class="container" style="padding: 3rem 0;">
    <h1 class="hero-title" style="text-align:center;">My <span class="accent">Calendar</span></h1>
    <p style="text-align:center; max-width:600px; margin: 0 auto 2rem; color:#555;">
      Organize your monthly appointments and events in a simple and practical way.
    </p>

    <div class="calendar-card card fade-in">
      <div class="calendar-header">
        <button id="prev-month" class="btn btn-outline btn-small">◀</button>
        <h2 id="month-year"></h2>
        <button id="next-month" class="btn btn-outline btn-small">▶</button>
      </div>
      <div class="calendar-grid" id="calendar-grid"></div>
      <div class="calendar-actions" style="text-align:center; margin-top:1.5rem;">
        <button id="add-event-btn" class="btn btn-primary">+ Add Event</button>
      </div>
    </div>
  </main>

  <!-- ===== Modal: Add Event ===== -->
  <div id="event-modal" class="modal">
    <div class="modal-content card">
      <h3>Add New Event</h3>
      <form id="event-form">
        <label>Title:</label>
        <input type="text" id="event-title" required>
        <label>Date:</label>
        <input type="date" id="event-date" required>
        <label>Time:</label>
        <input type="time" id="event-time">
        <label>Description:</label>
        <textarea id="event-desc" rows="3"></textarea>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" id="close-modal" class="btn btn-outline">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== Footer ===== -->
  <footer class="site-footer">
    <p>© <span id="year"></span> TimeSync. All rights reserved.</p>
  </footer>

  <!-- ===== Calendar Script ===== -->
<script>
  // ===== Atualizar ano =====
  document.getElementById("year").textContent = new Date().getFullYear();

  // ===== Calendar Logic =====
  const monthYear = document.getElementById("month-year");
  const calendarGrid = document.getElementById("calendar-grid");
  const prevBtn = document.getElementById("prev-month");
  const nextBtn = document.getElementById("next-month");
  const modal = document.getElementById("event-modal");
  const addEventBtn = document.getElementById("add-event-btn");
  const closeModal = document.getElementById("close-modal");
  const eventForm = document.getElementById("event-form");

  let currentDate = new Date();
  let events = JSON.parse(localStorage.getItem("calendarEvents")) || [];

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const monthName = currentDate.toLocaleString("en-US", { month: "long" });

    monthYear.textContent = `${monthName.charAt(0).toUpperCase() + monthName.slice(1)} ${year}`;

    calendarGrid.innerHTML = "";

    // Dias da semana
    const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    daysOfWeek.forEach(d => {
      const dayEl = document.createElement("div");
      dayEl.classList.add("day-name");
      dayEl.textContent = d;
      calendarGrid.appendChild(dayEl);
    });

    // Espaços antes do 1º dia
    for (let i = 0; i < firstDay.getDay(); i++) {
      const empty = document.createElement("div");
      empty.classList.add("day", "empty");
      calendarGrid.appendChild(empty);
    }

    // Dias do mês
    for (let d = 1; d <= lastDay.getDate(); d++) {
      const date = new Date(year, month, d);
      const dayEl = document.createElement("div");
      dayEl.classList.add("day");

      const formatted = date.toISOString().split("T")[0];
      const hasEvent = events.some(ev => ev.date === formatted);

      dayEl.innerHTML = `
        <span class="day-num">${d}</span>
        ${hasEvent ? '<span class="dot dot-blue"></span>' : ''}
      `;

      dayEl.addEventListener("click", () => showEvents(formatted));

      calendarGrid.appendChild(dayEl);
    }
  }

  function showEvents(date) {
    const dayEvents = events.filter(ev => ev.date === date);
    if (dayEvents.length === 0) {
      alert(`No events for ${date}.`);
      return;
    }

    let message = `Events on ${date}:\n\n`;
    dayEvents.forEach((ev, i) => {
      message += `${i + 1}. ${ev.title} (${ev.time || "no time"})\n${ev.desc || ""}\n\n`;
    });
    message += "Type the event number to delete it, or press Cancel to keep them.";

    const input = prompt(message);
    if (input && !isNaN(input) && input >= 1 && input <= dayEvents.length) {
      const indexToDelete = events.findIndex(ev =>
        ev.date === date && ev.title === dayEvents[input - 1].title
      );

      if (indexToDelete !== -1) {
        events.splice(indexToDelete, 1);
        localStorage.setItem("calendarEvents", JSON.stringify(events));
        alert("Event deleted successfully!");
        renderCalendar();
      }
    }
  }

  prevBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  nextBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  addEventBtn.addEventListener("click", () => {
    modal.style.display = "flex";
  });

  closeModal.addEventListener("click", () => {
    modal.style.display = "none";
  });

  eventForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const title = document.getElementById("event-title").value;
    const date = document.getElementById("event-date").value;
    const time = document.getElementById("event-time").value;
    const desc = document.getElementById("event-desc").value;

    events.push({ title, date, time, desc });
    localStorage.setItem("calendarEvents", JSON.stringify(events));

    eventForm.reset();
    modal.style.display = "none";
    renderCalendar();
  });

  window.onclick = (e) => {
    if (e.target === modal) modal.style.display = "none";
  };

  renderCalendar();
</script>
</body>
</html>
